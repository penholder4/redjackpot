<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RED JACKPOT</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700;800&display=swap" rel="stylesheet">

<style>
body {
    margin: 0;
    font-family: 'Poppins', sans-serif;
    background-color: #fff5f5;
    display: flex;
    justify-content: center;
    padding: 30px 16px;
}

.container {
    max-width: 720px;
    width: 100%;
    background: #ffeaea;
    padding: 30px;
    border-radius: 16px;
    box-shadow: 0 8px 20px rgba(200, 80, 80, 0.15);
    position: relative;
}

/* ğŸ”´ ê²½ê³  ë°•ìŠ¤ */
.alert-box{
    position:absolute;
    top:-120px;
    left:50%;
    transform:translateX(-50%);
    background:#FF6060;
    color:white;
    padding:18px 30px;
    border-radius:16px;
    text-align:center;
    box-shadow:0 8px 20px rgba(0,0,0,0.15);
    transition: top 0.3s ease, opacity 0.3s ease;
    opacity: 0;                 /* ê¸°ë³¸ì€ íˆ¬ëª… */
    pointer-events: none;
    z-index:100;
}

.alert-box.show{
    top:15px;
    opacity: 1;                 /* ë‚´ë ¤ì˜¬ ë•Œ ë³´ì´ê²Œ */
}


.alert-title{
    font-weight:800;
    font-size:18px;
}

.alert-msg{
    font-size:14px;
    margin-top:5px;
}

h1 { text-align:center; margin-bottom:30px; font-weight:800; }

.title-main { font-size:38px; color:#b30040; }
.title-sub { font-size:18px; color:#ff1e1e; margin-left:8px; }

.input-group {
    display:flex;
    gap:10px;
    margin-bottom:20px;
}

.input-group input {
    flex:1;
    padding:12px;
    border-radius:10px;
    border:1px solid #f2bcbc;
}

#nameInput { flex: 4; }
#idInput { flex: 4; }
#weightInput { flex: 2; }

button {
    padding:10px 16px;
    border-radius:10px;
    border:none;
    cursor:pointer;
    font-weight:600;
    color:white;
}


button:hover {
    filter: brightness(0.9);
}

/* ğŸ”¹ í´ë¦­ ì‹œ ëˆŒë¦¼ íš¨ê³¼ (ì„ íƒì‚¬í•­ì´ì§€ë§Œ ì¶”ì²œ) */
button:active {
    transform: scale(0.97);
}

.add-btn,
.select-all-btn,
.delete-selected-btn,
.download-btn { background:#ff6060; }

.draw-btn {
    background:#D41313;
    width:100%;
    margin-bottom:15px;
    font-weight:700;
}

.result {
    margin-bottom:20px;
    padding:20px;
    background:#ffd6d6;
    border-radius:12px;
    text-align:center;
    font-weight:700;
    color:#b30000;
    font-size:18px;
    display:none;
}

.list-wrapper {
    background:#fff;
    border-radius:12px;
    border:1px solid #f2bcbc;
    overflow:hidden;
}

.list-container {
    max-height:300px;
    overflow-y:auto;
}

.list-item {
    display:flex;
    align-items:center;
    padding:10px 15px;
    border-bottom:1px solid #f5d6d6;
}

.entry-info { display:flex; gap:10px; flex-wrap:wrap; }

.list-footer {
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:12px 15px;
    background:#ffd6d6;
    font-weight:600;
}

.confetti-container {
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    pointer-events:none;
    overflow:hidden;
    z-index:999;
}

.confetti {
    position:absolute;
    width:10px;
    height:16px;
    opacity:0.8;
    animation:fall linear forwards;
}

@keyframes fall {
    0% { transform: translateY(-10vh) rotate(0deg); }
    100% { transform: translateY(110vh) rotate(720deg); }
}

@media (max-width:600px){
    .input-group { flex-direction:column; }
    .list-footer { flex-direction:column; gap:10px; align-items:stretch; }
    .download-btn { width:100%; }
}
</style>
</head>

<body>
<div class="container">

<!-- ğŸ”´ ì»¤ìŠ¤í…€ ê²½ê³  -->
<div id="customAlert" class="alert-box">
    <div class="alert-title">ì£¼ì˜!</div>
    <div class="alert-msg"></div>
</div>

<h1>
<span class="title-main">RED JACKPOT</span>
<span class="title-sub">with ERY</span>
</h1>

<div class="input-group">
<input type="text" id="nameInput" placeholder="ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”">
<input type="text" id="idInput" placeholder="IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”">
<input type="number" id="weightInput"
       placeholder="ì‘ëª¨ê¶Œ ìˆ˜ ì…ë ¥"
       min="1" max="4">
<button class="add-btn" id="addButton">ì‘ëª¨í•˜ê¸°</button>
</div>

<button class="draw-btn" id="drawButton">ì¶”ì²¨í•˜ê¸°</button>
<div class="result" id="resultBox"></div>

<div class="list-wrapper">
<div class="list-container" id="entryList"></div>

<div class="list-footer">
<div>
<button class="select-all-btn" id="selectAllBtn">ì „ì²´ì„ íƒ</button>
<button class="delete-selected-btn" id="deleteBtn">ì‚­ì œí•˜ê¸°</button>
</div>
<div id="totalCount">ì´ ì‘ëª¨ì : 0ëª…</div>
<button class="download-btn" id="downloadBtn">ë‹¤ìš´ë¡œë“œ</button>
</div>
</div>

<div id="confettiContainer" class="confetti-container"></div>

<script>
const STORAGE_KEY="red_jackpot_entries";
let entries=JSON.parse(localStorage.getItem(STORAGE_KEY))||[];
let alertTimer;

const nameInput=document.getElementById("nameInput");
const idInput=document.getElementById("idInput");
const weightInput=document.getElementById("weightInput");
const resultBox=document.getElementById("resultBox");

function saveEntries(){
    localStorage.setItem(STORAGE_KEY,JSON.stringify(entries));
}

function updateTotalCount(){
    document.getElementById("totalCount").innerText=
        `ì´ ì‘ëª¨ì : ${entries.length}ëª…`;
}

/* ğŸ”´ íŒì—… í•¨ìˆ˜ */
function showPopup(message){
    const alertBox=document.getElementById("customAlert");
    const alertMsg=alertBox.querySelector(".alert-msg");

    clearTimeout(alertTimer);

    alertMsg.innerHTML=message;
    alertBox.classList.add("show");

    alertTimer=setTimeout(()=>{
        alertBox.classList.remove("show");
    },2300);
}

function addEntry(){
    const name=nameInput.value.trim();
    const id=idInput.value.trim();
    const weight=parseInt(weightInput.value);

    if(!name||!id){
        showPopup("ì´ë¦„ê³¼ ì•„ì´ë””ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
    }

    if(isNaN(weight)||weight<1||weight>4){
        showPopup("ì‘ëª¨ê¶Œ ìˆ˜ë¥¼ ì˜ëª» ì…ë ¥í•˜ì…¨ìŠµë‹ˆë‹¤.");
        return;
    }

    if(entries.some(e=>e.id===id)){
        showPopup("ì´ë¯¸ ë“±ë¡ëœ IDì…ë‹ˆë‹¤.<br>í™•ì¸ í›„ ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
    }

    entries.push({name,id,weight});
    saveEntries();
    renderList();
    updateTotalCount();

    nameInput.value="";
    idInput.value="";
    weightInput.value="";
}

function renderList(){
    const list=document.getElementById("entryList");
    list.innerHTML="";

    entries.forEach((entry,index)=>{
        const div=document.createElement("div");
        div.className="list-item";

        const checkbox=document.createElement("input");
        checkbox.type="checkbox";
        checkbox.className="entry-checkbox";
        checkbox.dataset.index=index;

        const info=document.createElement("div");
        info.className="entry-info";
        info.innerHTML=
            `<span>${entry.name}</span>
             <span>(@${entry.id})</span>
             <span>[ì‘ëª¨ê¶Œ ${entry.weight}]</span>`;

        div.appendChild(checkbox);
        div.appendChild(info);
        list.appendChild(div);
    });
}

function toggleSelectAll(){
    const checkboxes=document.querySelectorAll(".entry-checkbox");
    const allChecked=[...checkboxes].every(cb=>cb.checked);
    checkboxes.forEach(cb=>cb.checked=!allChecked);
}

function deleteSelected(){
    const checkboxes=document.querySelectorAll(".entry-checkbox");
    const selectedIndexes=[];
    checkboxes.forEach(cb=>{
        if(cb.checked) selectedIndexes.push(parseInt(cb.dataset.index));
    });
    selectedIndexes.sort((a,b)=>b-a);
    selectedIndexes.forEach(i=>entries.splice(i,1));
    saveEntries();
    renderList();
    updateTotalCount();
    resultBox.style.display="none";
}

function downloadCSV(){
    if(entries.length===0) return;
    let csvContent="ì´ë¦„,ì•„ì´ë””,ì‘ëª¨ê¶Œ ìˆ˜\n";
    entries.forEach(e=>{
        csvContent+=`${e.name},${e.id},${e.weight}\n`;
    });
    const blob=new Blob(["\uFEFF"+csvContent],{type:"text/csv;charset=utf-8;"});
    const url=URL.createObjectURL(blob);
    const link=document.createElement("a");
    link.href=url;
    link.download="red_jackpot_entries.csv";
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);
}

function drawWinner(){
    if(entries.length===0){
        showPopup("ì‘ëª¨ìê°€ ì—†ìŠµë‹ˆë‹¤.");
        return;
    }

    const totalWeight=entries.reduce((sum,e)=>sum+e.weight,0);
    let random=Math.floor(Math.random()*totalWeight);
    let winner=null;

    for(const entry of entries){
        if(random<entry.weight){
            winner=entry;
            break;
        }
        random-=entry.weight;
    }

    resultBox.style.display="block";
    resultBox.innerText=
        `ğŸ‰ ë‹¹ì²¨ì: ${winner.name} (@${winner.id})`;

    launchConfetti();
}

function launchConfetti(){
    const container=document.getElementById("confettiContainer");
    container.innerHTML="";
    for(let i=0;i<120;i++){
        const confetti=document.createElement("div");
        confetti.className="confetti";
        confetti.style.left=Math.random()*100+"vw";
        confetti.style.backgroundColor=
            ["#ff1e1e","#ff6b6b","#ffb3b3","#d90429"][Math.floor(Math.random()*4)];
        confetti.style.animationDuration=(Math.random()*3+2)+"s";
        container.appendChild(confetti);
    }
    setTimeout(()=>container.innerHTML="",5000);
}

document.getElementById("addButton").addEventListener("click",addEntry);
document.getElementById("drawButton").addEventListener("click",drawWinner);
document.getElementById("selectAllBtn").addEventListener("click",toggleSelectAll);
document.getElementById("deleteBtn").addEventListener("click",deleteSelected);
document.getElementById("downloadBtn").addEventListener("click",downloadCSV);

[nameInput, idInput, weightInput].forEach(input => {
    input.addEventListener("keydown", function(e) {
        if (e.key === "Enter") {
            addEntry();
        }
    });
});

renderList();
updateTotalCount();
</script>

</body>
</html>
